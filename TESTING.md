# 测试指南 - Chrome 番茄工作法计时器

## 功能测试

### 安装扩展
1. 打开 Chrome 浏览器，进入 `chrome://extensions/`
2. 开启右上角的"开发者模式"
3. 点击"加载已解压的扩展程序"
4. 选择项目文件夹
5. 扩展程序将自动加载并显示在工具栏中

### 测试动态图标功能

#### 1. 基本图标状态测试
- **初始状态**: 扩展图标应该没有徽章，悬停时显示"番茄工作法计时器"
- **开始工作计时**: 图标应显示红色徽章，显示剩余时间（如"25m"）
- **开始短休息**: 图标应显示绿色徽章，显示剩余时间（如"5m"）
- **开始长休息**: 图标应显示蓝色徽章，显示剩余时间（如"15m"）
- **暂停状态**: 图标徽章清空，恢复默认状态

#### 2. 关闭弹窗后的持续计时测试
1. 点击扩展图标打开弹窗
2. 选择任务类型（如"工作"）
3. 点击"开始"按钮开始计时
4. **关闭弹窗**（点击扩展图标外的任何地方）
5. 观察扩展图标：
   - 应该显示红色徽章（工作状态）
   - 徽章文字应该每秒更新倒计时
   - 悬停时应显示详细时间信息

#### 3. 计时状态恢复测试
1. 开始计时后关闭弹窗
2. 等待几分钟让计时器运行
3. 重新打开弹窗
4. 验证：
   - 弹窗中的时间与图标徽章一致
   - 计时器状态正确显示（工作/休息）
   - 可以正常暂停/继续/重置

#### 4. 完成阶段后的通知测试
1. 设置较短的工作时间（如1分钟）进行测试
2. 开始计时并关闭弹窗
3. 等待计时结束
4. 验证：
   - 收到桌面通知
   - 图标徽章颜色变化（工作→休息）
   - 自动进入下一阶段

#### 5. 浏览器重启测试
1. 开始计时
2. 关闭浏览器
3. 重新打开浏览器
4. 验证：
   - 扩展图标正确显示当前状态
   - 计时继续进行（如果时间未到）
   - 或显示应该完成的通知（如果时间已到）

### 预期的视觉效果

#### 图标徽章颜色含义：
- **红色 (#e53e3e)**: 工作时间
- **绿色 (#38a169)**: 短休息时间  
- **蓝色 (#3182ce)**: 长休息时间
- **无徽章**: 计时器未运行

#### 徽章文字格式：
- 超过1分钟: 显示分钟数 (如 "25m", "5m")
- 小于1分钟: 显示秒数 (如 "30s", "10s")

#### 悬停提示格式：
- 工作时间: "工作时间 - 24:30"
- 短休息: "短休息 - 4:45"  
- 长休息: "长休息 - 14:20"

## 技术验证

### 权限检查
确保 manifest.json 包含必要权限：
```json
"permissions": [
  "alarms",
  "notifications", 
  "storage",
  "action"
]
```

### API 调用验证
在浏览器开发者工具中检查：
- `chrome.action.setBadgeText()` 调用成功
- `chrome.action.setBadgeBackgroundColor()` 调用成功
- `chrome.action.setTitle()` 调用成功
- `chrome.alarms` 正常工作
- `chrome.notifications` 正常显示

### 错误处理测试
- 关闭通知权限后测试
- 在隐身模式下测试
- 多个浏览器窗口同时测试

## 已知功能确认

✅ 后台计时继续运行（使用 Service Worker + chrome.alarms）
✅ 弹窗关闭后通知仍然有效  
✅ 数据持久化和同步
✅ 多阶段自动切换（工作→短休息→工作→长休息）
✅ 历史记录和数据分析功能
✅ **新增**: 动态图标徽章显示计时状态